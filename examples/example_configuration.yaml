# Example Configuration for Floor Heating Valve Manager Blueprint
# 
# This file shows how to configure the blueprint for different scenarios.
# Copy the relevant configuration to your Home Assistant automations.yaml
# or create via the UI (Settings -> Automations & Scenes -> Create Automation -> Use Blueprint)

# ==============================================================================
# EXAMPLE 1: Basic Setup with 2 Zones
# ==============================================================================
# Scenario: You have a MAIN thermostat and 2 rooms (bedroom and bathroom)
# Using the virtual switch pattern (REQUIRED for Generic Thermostat)

# STEP 1: Create virtual switches in configuration.yaml
# input_boolean:
#   bedroom_virtual_valve:
#     name: "Bedroom Virtual Valve"
#   bathroom_virtual_valve:
#     name: "Bathroom Virtual Valve"

# STEP 2: Configure Generic Thermostats to use virtual switches
# climate:
#   - platform: generic_thermostat
#     name: Bedroom Thermostat
#     heater: input_boolean.bedroom_virtual_valve  # VIRTUAL, not physical!
#     target_sensor: sensor.bedroom_temperature
#   - platform: generic_thermostat
#     name: Bathroom Thermostat
#     heater: input_boolean.bathroom_virtual_valve  # VIRTUAL, not physical!
#     target_sensor: sensor.bathroom_temperature

# STEP 3: Configure blueprint with BOTH valve and virtual_switch (REQUIRED)
automation:
  - alias: Floor Heating - Basic 2 Zone
    use_blueprint:
      path: chester929/heat_zone_manager.yaml
      input:
        # MAIN thermostat
        main_thermostat: climate.main_hvac
        
        # Zone 1: Bedroom (BOTH valve and virtual_switch REQUIRED)
        zone1_climate: climate.bedroom_thermostat
        zone1_valve: switch.bedroom_physical_valve           # REQUIRED
        zone1_virtual_switch: input_boolean.bedroom_virtual_valve  # REQUIRED
        
        # Zone 2: Bathroom (BOTH valve and virtual_switch REQUIRED)
        zone2_climate: climate.bathroom_thermostat
        zone2_valve: switch.bathroom_physical_valve          # REQUIRED
        zone2_virtual_switch: input_boolean.bathroom_virtual_valve  # REQUIRED
        
        # Temperature thresholds
        temp_difference_open: 0.5
        temp_difference_close: 0.2
        
        # When all zones satisfied, use average temperature
        all_satisfied_temp_mode: 50
        
        # MAIN thermostat limits
        min_main_temp: 18.0
        max_main_temp: 28.0

# ==============================================================================
# EXAMPLE 2: Advanced Setup with Manual Overrides
# ==============================================================================
# Scenario: You have separate temperature sensors and valve switches
# Using virtual switch pattern for proper coordination

# STEP 1: Create virtual switches in configuration.yaml
# input_boolean:
#   bedroom_virtual_valve:
#     name: "Bedroom Virtual Valve"
#   bathroom_virtual_valve:
#     name: "Bathroom Virtual Valve"
#   living_virtual_valve:
#     name: "Living Room Virtual Valve"

# STEP 2: Configure Generic Thermostats
# climate:
#   - platform: generic_thermostat
#     name: Bedroom Controller
#     heater: input_boolean.bedroom_virtual_valve
#     target_sensor: sensor.bedroom_temperature
#   - platform: generic_thermostat
#     name: Bathroom Controller
#     heater: input_boolean.bathroom_virtual_valve
#     target_sensor: sensor.bathroom_temperature_accurate
#   - platform: generic_thermostat
#     name: Living Thermostat
#     heater: input_boolean.living_virtual_valve
#     target_sensor: sensor.living_temperature

# STEP 3: Configure blueprint
automation:
  - alias: Floor Heating - Advanced with Overrides
    use_blueprint:
      path: chester929/heat_zone_manager.yaml
      input:
        # MAIN thermostat
        main_thermostat: climate.de_dietrich_main
        
        # IMPORTANT: Add MAIN sensor for intelligent compensation
        # This sensor is typically in the corridor where HVAC measures temperature
        main_temp_sensor: sensor.corridor_temperature
        
        # Zone 1: Bedroom (with manual overrides)
        zone1_climate: climate.bedroom_controller
        zone1_temp_sensor: sensor.bedroom_temperature
        zone1_valve: switch.bedroom_valve                    # REQUIRED
        zone1_virtual_switch: input_boolean.bedroom_virtual_valve  # REQUIRED
        
        # Zone 2: Bathroom (with temperature sensor override)
        zone2_climate: climate.bathroom_controller
        zone2_temp_sensor: sensor.bathroom_temperature_accurate
        zone2_valve: switch.bathroom_valve                   # REQUIRED
        zone2_virtual_switch: input_boolean.bathroom_virtual_valve  # REQUIRED
        
        # Zone 3: Living Room
        zone3_climate: climate.living_room_thermostat
        zone3_valve: switch.living_valve                     # REQUIRED
        zone3_virtual_switch: input_boolean.living_virtual_valve  # REQUIRED
        
        # Fine-tuned temperature thresholds
        temp_difference_open: 0.3
        temp_difference_close: 0.1
        
        # When all zones satisfied, use lowest temperature (conservative)
        all_satisfied_temp_mode: 10
        
        # MAIN thermostat limits
        min_main_temp: 19.0
        max_main_temp: 26.0
        

# ==============================================================================
# EXAMPLE 3: Full 5 Zone Setup
# ==============================================================================
# Scenario: Maximum zones with different configurations per room

# STEP 1: Create virtual switches
# input_boolean:
#   master_bedroom_virtual_valve:
#     name: "Master Bedroom Virtual Valve"
#   guest_bedroom_virtual_valve:
#     name: "Guest Bedroom Virtual Valve"
#   bathroom_virtual_valve:
#     name: "Bathroom Virtual Valve"
#   living_virtual_valve:
#     name: "Living Room Virtual Valve"
#   kitchen_virtual_valve:
#     name: "Kitchen Virtual Valve"

# STEP 2: Configure Generic Thermostats (abbreviated for space)
# climate:
#   - platform: generic_thermostat
#     name: Master Bedroom
#     heater: input_boolean.master_bedroom_virtual_valve
#     target_sensor: sensor.master_bedroom_temp
#   # ... (similar for other zones)

# STEP 3: Configure blueprint
automation:
  - alias: Floor Heating - Full 5 Zone House
    use_blueprint:
      path: chester929/heat_zone_manager.yaml
      input:
        # MAIN thermostat
        main_thermostat: climate.main_heat_pump
        
        # Zone 1: Master Bedroom
        zone1_climate: climate.master_bedroom
        zone1_temp_sensor: sensor.master_bedroom_temp
        zone1_valve: switch.master_bedroom_valve             # REQUIRED
        zone1_virtual_switch: input_boolean.master_bedroom_virtual_valve  # REQUIRED
        
        # Zone 2: Guest Bedroom
        zone2_climate: climate.guest_bedroom
        zone2_valve: switch.guest_bedroom_valve              # REQUIRED
        zone2_virtual_switch: input_boolean.guest_bedroom_virtual_valve  # REQUIRED
        
        # Zone 3: Bathroom
        zone3_climate: climate.bathroom
        zone3_temp_sensor: sensor.bathroom_temp
        zone3_valve: switch.bathroom_floor_valve             # REQUIRED
        zone3_virtual_switch: input_boolean.bathroom_virtual_valve  # REQUIRED
        
        # Zone 4: Living Room
        zone4_climate: climate.living_room
        zone4_temp_sensor: sensor.living_room_temp
        zone4_valve: switch.living_valve                     # REQUIRED
        zone4_virtual_switch: input_boolean.living_virtual_valve  # REQUIRED
        
        # Zone 5: Kitchen
        zone5_climate: climate.kitchen
        zone5_valve: switch.kitchen_valve                    # REQUIRED
        zone5_virtual_switch: input_boolean.kitchen_virtual_valve  # REQUIRED
        
        # Temperature management
        temp_difference_open: 0.5
        temp_difference_close: 0.2
        all_satisfied_temp_mode: 50  # Use average
        min_main_temp: 18.0
        max_main_temp: 28.0

# ==============================================================================
# EXAMPLE 4: Cooling Mode Setup (Air Conditioning)
# ==============================================================================
# Scenario: Your system supports cooling and you want inverse logic

# STEP 1: Create virtual switches (see previous examples)
# STEP 2: Configure Generic Thermostats (see previous examples)

# STEP 3: Configure blueprint with cooling mode
automation:
  - alias: Floor Cooling - Summer Mode
    use_blueprint:
      path: chester929/heat_zone_manager.yaml
      input:
        # MAIN thermostat with cooling capability
        main_thermostat: climate.main_hvac_heat_cool
        
        # Zones
        zone1_climate: climate.bedroom
        zone1_valve: switch.bedroom_valve
        zone1_virtual_switch: input_boolean.bedroom_virtual_valve
        
        zone2_climate: climate.bathroom
        zone2_valve: switch.bathroom_valve
        zone2_virtual_switch: input_boolean.bathroom_virtual_valve
        
        zone3_climate: climate.living_room
        zone3_valve: switch.living_valve
        zone3_virtual_switch: input_boolean.living_virtual_valve
        
        # Enable cooling mode (inverse logic)
        enable_cooling_mode: true
        
        # Temperature thresholds
        temp_difference_open: 0.5
        temp_difference_close: 0.2
        
        # When all zones satisfied, use highest temperature (for cooling)
        all_satisfied_temp_mode: 90
        
        # MAIN thermostat limits for cooling
        min_main_temp: 20.0
        max_main_temp: 26.0
        

# ==============================================================================
# EXAMPLE 5: Conservative Setup (Slower Response)
# ==============================================================================
# Scenario: You want more stable operation with less frequent changes

# Virtual switches and Generic Thermostats required (see Example 1)

automation:
  - alias: Floor Heating - Conservative Mode
    use_blueprint:
      path: chester929/heat_zone_manager.yaml
      input:
        # MAIN thermostat
        main_thermostat: climate.main_thermostat
        
        # Zones (BOTH valve and virtual_switch REQUIRED for each)
        zone1_climate: climate.bedroom
        zone1_valve: switch.bedroom_valve
        zone1_virtual_switch: input_boolean.bedroom_virtual_valve
        
        zone2_climate: climate.bathroom
        zone2_valve: switch.bathroom_valve
        zone2_virtual_switch: input_boolean.bathroom_virtual_valve
        
        zone3_climate: climate.living_room
        zone3_valve: switch.living_valve
        zone3_virtual_switch: input_boolean.living_virtual_valve
        
        # Larger thresholds = less frequent valve switching
        temp_difference_open: 1.0
        temp_difference_close: 0.5
        
        # Use lowest temperature when all satisfied (conservative)
        all_satisfied_temp_mode: 0
        
        # Wider limits
        min_main_temp: 17.0
        max_main_temp: 30.0
        

# ==============================================================================
# EXAMPLE 6: Aggressive Setup (Faster Response)
# ==============================================================================
# Scenario: You want quick response and frequent adjustments

# Virtual switches and Generic Thermostats required (see Example 1)

automation:
  - alias: Floor Heating - Aggressive Mode
    use_blueprint:
      path: chester929/heat_zone_manager.yaml
      input:
        # MAIN thermostat
        main_thermostat: climate.main_thermostat
        
        # Zones (BOTH valve and virtual_switch REQUIRED for each)
        zone1_climate: climate.bedroom
        zone1_valve: switch.bedroom_valve
        zone1_virtual_switch: input_boolean.bedroom_virtual_valve
        
        zone2_climate: climate.bathroom
        zone2_valve: switch.bathroom_valve
        zone2_virtual_switch: input_boolean.bathroom_virtual_valve
        
        zone3_climate: climate.living_room
        zone3_valve: switch.living_valve
        zone3_virtual_switch: input_boolean.living_virtual_valve
        
        # Smaller thresholds = more frequent valve switching
        temp_difference_open: 0.2
        temp_difference_close: 0.1
        
        # Use highest temperature when all satisfied (aggressive heating)
        all_satisfied_temp_mode: 100
        
        # Tighter limits
        min_main_temp: 19.0
        max_main_temp: 27.0
        

# ==============================================================================
# EXAMPLE 7: Intelligent Compensation for Corridor/Zone Temperature Differences
# ==============================================================================
# Scenario: MAIN sensor is in corridor which is often warmer than bedrooms
# This example shows how to use the intelligent compensation feature

# Virtual switches and Generic Thermostats required (see Example 1)

automation:
  - alias: Floor Heating - Corridor Compensation
    use_blueprint:
      path: chester929/heat_zone_manager.yaml
      input:
        # MAIN thermostat
        main_thermostat: climate.main_hvac
        
        # KEY FEATURE: Provide corridor temperature sensor
        # This enables intelligent compensation when corridor differs from zones
        main_temp_sensor: sensor.corridor_temperature
        
        # Zones - bedrooms are typically cooler than corridor
        zone1_climate: climate.bedroom_1
        zone1_temp_sensor: sensor.bedroom_1_temperature
        zone1_valve: switch.bedroom1_valve
        zone1_virtual_switch: input_boolean.bedroom1_virtual_valve
        
        zone2_climate: climate.bedroom_2
        zone2_temp_sensor: sensor.bedroom_2_temperature
        zone2_valve: switch.bedroom2_valve
        zone2_virtual_switch: input_boolean.bedroom2_virtual_valve
        
        zone3_climate: climate.bathroom
        zone3_temp_sensor: sensor.bathroom_temperature
        zone3_valve: switch.bathroom_valve
        zone3_virtual_switch: input_boolean.bathroom_virtual_valve
        
        # Temperature thresholds
        temp_difference_open: 0.5
        temp_difference_close: 0.2
        
        # Use average when all satisfied
        all_satisfied_temp_mode: 50
        
        # MAIN thermostat limits
        min_main_temp: 18.0
        max_main_temp: 28.0

# HOW IT WORKS:
# When corridor is 23°C and bedroom needs to reach 22°C from 20°C:
# - Without compensation: MAIN target = 22°C (HVAC sees corridor at 23°C, won't heat enough)
# - With compensation: MAIN target = 23°C (compensates for 2°C deficit, heats adequately)
# The blueprint automatically adds 50% of temperature deficit as compensation


# ==============================================================================
# EXAMPLE 8: Fallback Zones to Prevent Overheating
# ==============================================================================
# Scenario: Prevent overheating when all zones satisfied
# Use fallback zones instead of opening all valves

# Virtual switches and Generic Thermostats required (see Example 1)

automation:
  - alias: Floor Heating - Fallback Zones
    use_blueprint:
      path: chester929/heat_zone_manager.yaml
      input:
        # MAIN thermostat
        main_thermostat: climate.main_hvac
        main_temp_sensor: sensor.corridor_temperature
        
        # Zones
        zone1_climate: climate.bedroom_1
        zone1_valve: switch.bedroom1_valve
        zone1_virtual_switch: input_boolean.bedroom1_virtual_valve
        
        zone2_climate: climate.bedroom_2
        zone2_valve: switch.bedroom2_valve
        zone2_virtual_switch: input_boolean.bedroom2_virtual_valve
        
        zone3_climate: climate.bathroom
        zone3_valve: switch.bathroom_valve
        zone3_virtual_switch: input_boolean.bathroom_virtual_valve
        
        zone4_climate: climate.corridor
        zone4_valve: switch.corridor_valve
        zone4_virtual_switch: input_boolean.corridor_virtual_valve
        
        # KEY FEATURE: Fallback zones
        # These zone(s) stay open when all zones are satisfied or overheated
        # Ensures pump safety without overheating rooms
        fallback_zones:
          - climate.corridor  # Corridor is least critical, keeps pump running
        
        # Overheated threshold - close all except fallback when zones exceed this
        overheated_threshold: 1.0  # If zone is 1°C above target, it's overheated
        
        # Temperature thresholds
        temp_difference_open: 0.5
        temp_difference_close: 0.2
        all_satisfied_temp_mode: 50
        min_main_temp: 18.0
        max_main_temp: 28.0

# HOW IT WORKS:
# Scenario 1 - All satisfied:
#   - OLD: Opens ALL valves (bedroom1, bedroom2, bathroom, corridor)
#   - NEW: Opens ONLY corridor valve (fallback)
#   - Benefit: Prevents overheating bedrooms while maintaining pump safety
#
# Scenario 2 - All overheated (all zones > target + 1°C):
#   - Closes ALL valves EXCEPT corridor (fallback)
#   - Sets MAIN target to minimum (18°C)
#   - System cools down safely without closing all valves


# ==============================================================================
# EXAMPLE 9: Generic Thermostat with Virtual Switch Pattern (RECOMMENDED)
# ==============================================================================
# Scenario: Your zones use Generic Thermostat entities
# This is the BEST solution to prevent conflicts while keeping real temperatures

# ARCHITECTURE:
#   Climate Entity → Virtual Switch → Blueprint → Physical Valve
#
# WHY THIS WORKS:
#   - Climate entity controls virtual switch (keeps real target temps)
#   - Blueprint monitors virtual switch (understands climate entity's wants)
#   - Blueprint controls physical valve (final authority, coordination)
#   - NO CONFLICTS because they control different entities

# STEP 1: Create virtual switches (in configuration.yaml)
# input_boolean:
#   bedroom_virtual_valve:
#     name: "Bedroom Virtual Valve"
#   bathroom_virtual_valve:
#     name: "Bathroom Virtual Valve"
#   living_virtual_valve:
#     name: "Living Virtual Valve"

# STEP 2: Configure Generic Thermostats to use virtual switches
# climate:
#   - platform: generic_thermostat
#     name: Bedroom Thermostat
#     heater: input_boolean.bedroom_virtual_valve  # VIRTUAL, not physical!
#     target_sensor: sensor.bedroom_temperature
#   - platform: generic_thermostat
#     name: Bathroom Thermostat
#     heater: input_boolean.bathroom_virtual_valve  # VIRTUAL, not physical!
#     target_sensor: sensor.bathroom_temperature
#   - platform: generic_thermostat
#     name: Living Thermostat
#     heater: input_boolean.living_virtual_valve  # VIRTUAL, not physical!
#     target_sensor: sensor.living_temperature

# STEP 3: Configure blueprint with both virtual switches AND physical valves
automation:
  - alias: Floor Heating - Virtual Switch Pattern
    use_blueprint:
      path: chester929/heat_zone_manager.yaml
      input:
        # MAIN thermostat
        main_thermostat: climate.main_hvac
        main_temp_sensor: sensor.corridor_temperature
        
        # Zone 1: Bedroom
        zone1_climate: climate.bedroom_thermostat              # For temp reading
        zone1_temp_sensor: sensor.bedroom_temperature          # Optional override
        zone1_valve: switch.bedroom_physical_valve             # PHYSICAL valve (blueprint controls)
        zone1_virtual_switch: input_boolean.bedroom_virtual_valve  # Virtual switch (climate controls)
        
        # Zone 2: Bathroom
        zone2_climate: climate.bathroom_thermostat
        zone2_temp_sensor: sensor.bathroom_temperature
        zone2_valve: switch.bathroom_physical_valve            # PHYSICAL valve
        zone2_virtual_switch: input_boolean.bathroom_virtual_valve  # Virtual switch
        
        # Zone 3: Living Room
        zone3_climate: climate.living_thermostat
        zone3_temp_sensor: sensor.living_temperature
        zone3_valve: switch.living_physical_valve              # PHYSICAL valve
        zone3_virtual_switch: input_boolean.living_virtual_valve   # Virtual switch
        
        # Temperature thresholds
        temp_difference_open: 0.5
        temp_difference_close: 0.2
        all_satisfied_temp_mode: 50
        min_main_temp: 18.0
        max_main_temp: 28.0
        
        # Fallback zone for pump safety
        fallback_zones:
          - climate.living_thermostat

# HOW IT WORKS:
# 
# Example: Bedroom at 20°C, target 22°C
# 
# 1. Generic Thermostat Logic:
#    - Current (20°C) < Target (22°C)
#    - Decision: "I need heating"
#    - Action: Turn ON input_boolean.bedroom_virtual_valve
# 
# 2. Blueprint Logic:
#    - Reads: bedroom temp 20°C, target 22°C
#    - Checks: 20°C < (22°C - 0.5°C)? YES → temperature needs heating
#    - Checks: virtual_switch (input_boolean.bedroom_virtual_valve) = ON?  YES
#    - Decision: "Zone needs action" (BOTH conditions true)
#    - Also considers: coordination with other zones, pump safety
#    - Action: Turn ON switch.bedroom_physical_valve
# 
# 3. When bedroom reaches 22.2°C:
#    - Generic Thermostat: "I'm satisfied" → Turn OFF virtual switch
#    - Blueprint: Sees virtual switch OFF → closes physical valve
#      (unless needed for pump safety or coordination)
# 
# BENEFITS:
# ✅ Climate entity keeps real target (22°C), not extreme value
# ✅ You can still adjust target temp in climate entity UI
# ✅ NO conflicts - separate entities for climate vs blueprint
# ✅ Blueprint has final control over physical valves
# ✅ Blueprint can coordinate across zones
# ✅ Clean architecture, easy to debug


# ==============================================================================
# EXAMPLE 10: DEPRECATED - This pattern NO LONGER WORKS
# ==============================================================================
# ⚠️ WARNING: This example is kept for reference only. The blueprint now REQUIRES
# both valve and virtual_switch to be specified together for proper operation.
#
# The validation in the blueprint will reject configurations that only specify
# the valve without a virtual switch (or vice versa).
#
# REASON: Generic Thermostat entities MUST have a heater configured and will
# conflict with the blueprint if both try to control the same physical valve.
#
# SOLUTION: Use the virtual switch pattern shown in Example 9 (REQUIRED).
#
# If you previously used this pattern, please migrate to the virtual switch
# pattern as shown in Example 1 or Example 9.
# ==============================================================================


# ==============================================================================
# NOTES ON ENTITY NAMING
# ==============================================================================
# 
# Replace the example entity IDs with your actual entities:
#
# climate.main_hvac              -> Your MAIN HVAC thermostat
# climate.bedroom_thermostat     -> Your bedroom climate entity
# sensor.bedroom_temperature     -> Your bedroom temperature sensor
# switch.bedroom_valve           -> Your bedroom valve switch
#
# To find your entity IDs:
# 1. Go to Developer Tools -> States in Home Assistant
# 2. Search for your devices
# 3. Copy the entity_id column values
#
# ==============================================================================
# RECOMMENDED STARTING VALUES
# ==============================================================================
#
# For most setups, start with these values:
# - temp_difference_open: 0.5°C
# - temp_difference_close: 0.2°C
# - all_satisfied_temp_mode: 50% (average)
# - min_main_temp: 18.0°C
# - max_main_temp: 28.0°C
#
# Then adjust based on your system's behavior and preferences.
