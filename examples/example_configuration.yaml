# Example Configuration for Floor Heating Valve Manager Blueprint
# 
# This file shows how to configure the blueprint for different scenarios.
# Copy the relevant configuration to your Home Assistant automations.yaml
# or create via the UI (Settings -> Automations & Scenes -> Create Automation -> Use Blueprint)

# ==============================================================================
# EXAMPLE 1: Basic Setup with 2 Zones
# ==============================================================================
# Scenario: You have a MAIN thermostat and 2 rooms (bedroom and bathroom)
# Both rooms use climate entities that directly control their valves

automation:
  - alias: Floor Heating - Basic 2 Zone
    use_blueprint:
      path: chester929/heat_zone_manager.yaml
      input:
        # MAIN thermostat
        main_thermostat: climate.main_hvac
        
        # Zone 1: Bedroom
        zone1_climate: climate.bedroom_thermostat
        
        # Zone 2: Bathroom
        zone2_climate: climate.bathroom_thermostat
        
        # Temperature thresholds
        temp_difference_open: 0.5
        temp_difference_close: 0.2
        
        # When all zones satisfied, use average temperature
        all_satisfied_temp_mode: 50
        
        # MAIN thermostat limits
        min_main_temp: 18.0
        max_main_temp: 28.0

# ==============================================================================
# EXAMPLE 2: Advanced Setup with Manual Overrides
# ==============================================================================
# Scenario: You have separate temperature sensors and valve switches
# that are not part of the climate entities

automation:
  - alias: Floor Heating - Advanced with Overrides
    use_blueprint:
      path: chester929/heat_zone_manager.yaml
      input:
        # MAIN thermostat
        main_thermostat: climate.de_dietrich_main
        
        # IMPORTANT: Add MAIN sensor for intelligent compensation
        # This sensor is typically in the corridor where HVAC measures temperature
        main_temp_sensor: sensor.corridor_temperature
        
        # Zone 1: Bedroom (with manual overrides)
        zone1_climate: climate.bedroom_controller
        zone1_temp_sensor: sensor.bedroom_temperature
        zone1_valve: switch.bedroom_valve
        
        # Zone 2: Bathroom (with temperature sensor override only)
        zone2_climate: climate.bathroom_controller
        zone2_temp_sensor: sensor.bathroom_temperature_accurate
        # No valve override - use climate entity to control valve
        
        # Zone 3: Living Room (climate entity controls everything)
        zone3_climate: climate.living_room_thermostat
        
        # Fine-tuned temperature thresholds
        temp_difference_open: 0.3
        temp_difference_close: 0.1
        
        # When all zones satisfied, use lowest temperature (conservative)
        all_satisfied_temp_mode: 10
        
        # MAIN thermostat limits
        min_main_temp: 19.0
        max_main_temp: 26.0
        

# ==============================================================================
# EXAMPLE 3: Full 5 Zone Setup
# ==============================================================================
# Scenario: Maximum zones with different configurations per room

automation:
  - alias: Floor Heating - Full 5 Zone House
    use_blueprint:
      path: chester929/heat_zone_manager.yaml
      input:
        # MAIN thermostat
        main_thermostat: climate.main_heat_pump
        
        # Zone 1: Master Bedroom
        zone1_climate: climate.master_bedroom
        zone1_temp_sensor: sensor.master_bedroom_temp
        
        # Zone 2: Guest Bedroom
        zone2_climate: climate.guest_bedroom
        
        # Zone 3: Bathroom
        zone3_climate: climate.bathroom
        zone3_temp_sensor: sensor.bathroom_temp
        zone3_valve: switch.bathroom_floor_valve
        
        # Zone 4: Living Room
        zone4_climate: climate.living_room
        zone4_temp_sensor: sensor.living_room_temp
        
        # Zone 5: Kitchen
        zone5_climate: climate.kitchen
        
        # Temperature management
        temp_difference_open: 0.5
        temp_difference_close: 0.2
        all_satisfied_temp_mode: 50  # Use average
        min_main_temp: 18.0
        max_main_temp: 28.0

# ==============================================================================
# EXAMPLE 4: Cooling Mode Setup (Air Conditioning)
# ==============================================================================
# Scenario: Your system supports cooling and you want inverse logic

automation:
  - alias: Floor Cooling - Summer Mode
    use_blueprint:
      path: chester929/heat_zone_manager.yaml
      input:
        # MAIN thermostat with cooling capability
        main_thermostat: climate.main_hvac_heat_cool
        
        # Zones
        zone1_climate: climate.bedroom
        zone2_climate: climate.bathroom
        zone3_climate: climate.living_room
        
        # Enable cooling mode (inverse logic)
        enable_cooling_mode: true
        
        # Temperature thresholds
        temp_difference_open: 0.5
        temp_difference_close: 0.2
        
        # When all zones satisfied, use highest temperature (for cooling)
        all_satisfied_temp_mode: 90
        
        # MAIN thermostat limits for cooling
        min_main_temp: 20.0
        max_main_temp: 26.0
        

# ==============================================================================
# EXAMPLE 5: Conservative Setup (Slower Response)
# ==============================================================================
# Scenario: You want more stable operation with less frequent changes

automation:
  - alias: Floor Heating - Conservative Mode
    use_blueprint:
      path: chester929/heat_zone_manager.yaml
      input:
        # MAIN thermostat
        main_thermostat: climate.main_thermostat
        
        # Zones
        zone1_climate: climate.bedroom
        zone2_climate: climate.bathroom
        zone3_climate: climate.living_room
        
        # Larger thresholds = less frequent valve switching
        temp_difference_open: 1.0
        temp_difference_close: 0.5
        
        # Use lowest temperature when all satisfied (conservative)
        all_satisfied_temp_mode: 0
        
        # Wider limits
        min_main_temp: 17.0
        max_main_temp: 30.0
        

# ==============================================================================
# EXAMPLE 6: Aggressive Setup (Faster Response)
# ==============================================================================
# Scenario: You want quick response and frequent adjustments

automation:
  - alias: Floor Heating - Aggressive Mode
    use_blueprint:
      path: chester929/heat_zone_manager.yaml
      input:
        # MAIN thermostat
        main_thermostat: climate.main_thermostat
        
        # Zones
        zone1_climate: climate.bedroom
        zone2_climate: climate.bathroom
        zone3_climate: climate.living_room
        
        # Smaller thresholds = more frequent valve switching
        temp_difference_open: 0.2
        temp_difference_close: 0.1
        
        # Use highest temperature when all satisfied (aggressive heating)
        all_satisfied_temp_mode: 100
        
        # Tighter limits
        min_main_temp: 19.0
        max_main_temp: 27.0
        

# ==============================================================================
# EXAMPLE 7: Intelligent Compensation for Corridor/Zone Temperature Differences
# ==============================================================================
# Scenario: MAIN sensor is in corridor which is often warmer than bedrooms
# This example shows how to use the intelligent compensation feature

automation:
  - alias: Floor Heating - Corridor Compensation
    use_blueprint:
      path: chester929/heat_zone_manager.yaml
      input:
        # MAIN thermostat
        main_thermostat: climate.main_hvac
        
        # KEY FEATURE: Provide corridor temperature sensor
        # This enables intelligent compensation when corridor differs from zones
        main_temp_sensor: sensor.corridor_temperature
        
        # Zones - bedrooms are typically cooler than corridor
        zone1_climate: climate.bedroom_1
        zone1_temp_sensor: sensor.bedroom_1_temperature
        
        zone2_climate: climate.bedroom_2
        zone2_temp_sensor: sensor.bedroom_2_temperature
        
        zone3_climate: climate.bathroom
        zone3_temp_sensor: sensor.bathroom_temperature
        
        # Temperature thresholds
        temp_difference_open: 0.5
        temp_difference_close: 0.2
        
        # Use average when all satisfied
        all_satisfied_temp_mode: 50
        
        # MAIN thermostat limits
        min_main_temp: 18.0
        max_main_temp: 28.0

# HOW IT WORKS:
# When corridor is 23°C and bedroom needs to reach 22°C from 20°C:
# - Without compensation: MAIN target = 22°C (HVAC sees corridor at 23°C, won't heat enough)
# - With compensation: MAIN target = 23°C (compensates for 2°C deficit, heats adequately)
# The blueprint automatically adds 50% of temperature deficit as compensation


# ==============================================================================
# EXAMPLE 8: Fallback Zones to Prevent Overheating
# ==============================================================================
# Scenario: Prevent overheating when all zones satisfied
# Use fallback zones instead of opening all valves

automation:
  - alias: Floor Heating - Fallback Zones
    use_blueprint:
      path: chester929/heat_zone_manager.yaml
      input:
        # MAIN thermostat
        main_thermostat: climate.main_hvac
        main_temp_sensor: sensor.corridor_temperature
        
        # Zones
        zone1_climate: climate.bedroom_1
        zone2_climate: climate.bedroom_2
        zone3_climate: climate.bathroom
        zone4_climate: climate.corridor
        
        # KEY FEATURE: Fallback zones
        # These zone(s) stay open when all zones are satisfied or overheated
        # Ensures pump safety without overheating rooms
        fallback_zones:
          - climate.corridor  # Corridor is least critical, keeps pump running
        
        # Overheated threshold - close all except fallback when zones exceed this
        overheated_threshold: 1.0  # If zone is 1°C above target, it's overheated
        
        # Temperature thresholds
        temp_difference_open: 0.5
        temp_difference_close: 0.2
        all_satisfied_temp_mode: 50
        min_main_temp: 18.0
        max_main_temp: 28.0

# HOW IT WORKS:
# Scenario 1 - All satisfied:
#   - OLD: Opens ALL valves (bedroom1, bedroom2, bathroom, corridor)
#   - NEW: Opens ONLY corridor valve (fallback)
#   - Benefit: Prevents overheating bedrooms while maintaining pump safety
#
# Scenario 2 - All overheated (all zones > target + 1°C):
#   - Closes ALL valves EXCEPT corridor (fallback)
#   - Sets MAIN target to minimum (18°C)
#   - System cools down safely without closing all valves


# ==============================================================================
# EXAMPLE 9: Generic Thermostat with Valve Override (RECOMMENDED)
# ==============================================================================
# Scenario: Your zones use Generic Thermostat entities that control valve switches
# This setup prevents conflicts between the climate entity and blueprint

automation:
  - alias: Floor Heating - Generic Thermostat with Valve Override
    use_blueprint:
      path: chester929/heat_zone_manager.yaml
      input:
        # MAIN thermostat
        main_thermostat: climate.main_hvac
        main_temp_sensor: sensor.corridor_temperature
        
        # Zone 1: Bedroom with Generic Thermostat
        # IMPORTANT: Specify the valve override to prevent conflicts!
        zone1_climate: climate.bedroom_generic_thermostat
        zone1_temp_sensor: sensor.bedroom_temperature
        zone1_valve: switch.bedroom_valve  # Direct valve control - prevents conflict
        
        # Zone 2: Bathroom with Generic Thermostat
        zone2_climate: climate.bathroom_generic_thermostat
        zone2_temp_sensor: sensor.bathroom_temperature
        zone2_valve: switch.bathroom_valve  # Direct valve control - prevents conflict
        
        # Zone 3: Living Room with Generic Thermostat
        zone3_climate: climate.living_generic_thermostat
        zone3_temp_sensor: sensor.living_temperature
        zone3_valve: switch.living_valve  # Direct valve control - prevents conflict
        
        # Temperature thresholds
        temp_difference_open: 0.5
        temp_difference_close: 0.2
        all_satisfied_temp_mode: 50
        min_main_temp: 18.0
        max_main_temp: 28.0

# WHY VALVE OVERRIDE IS RECOMMENDED:
# 
# Generic Thermostats (and similar climate entities) have built-in logic that 
# automatically controls valves based on current vs target temperature.
# 
# Without valve override:
#   - Climate entity controls valve based on its temperature comparison
#   - Blueprint also controls valve based on ITS temperature comparison
#   - Result: Two controllers fighting each other
#   - The blueprint handles this by overriding the climate target temperature,
#     but this can be confusing
# 
# With valve override (RECOMMENDED):
#   - Blueprint controls valve directly via switch.bedroom_valve
#   - Climate entity is only used for reading current temperature and target
#   - No conflict - clear separation of concerns
#   - Better control and easier to debug
# 
# If you CANNOT use valve override:
#   - The blueprint will automatically handle the conflict by:
#     * Setting extreme target temperatures when valve should be open
#     * Setting climate to OFF when valve should be closed
#   - Your zone climate target temperatures will be overridden
#   - This works but is less intuitive


# ==============================================================================
# NOTES ON ENTITY NAMING
# ==============================================================================
# 
# Replace the example entity IDs with your actual entities:
#
# climate.main_hvac              -> Your MAIN HVAC thermostat
# climate.bedroom_thermostat     -> Your bedroom climate entity
# sensor.bedroom_temperature     -> Your bedroom temperature sensor
# switch.bedroom_valve           -> Your bedroom valve switch
#
# To find your entity IDs:
# 1. Go to Developer Tools -> States in Home Assistant
# 2. Search for your devices
# 3. Copy the entity_id column values
#
# ==============================================================================
# RECOMMENDED STARTING VALUES
# ==============================================================================
#
# For most setups, start with these values:
# - temp_difference_open: 0.5°C
# - temp_difference_close: 0.2°C
# - all_satisfied_temp_mode: 50% (average)
# - min_main_temp: 18.0°C
# - max_main_temp: 28.0°C
#
# Then adjust based on your system's behavior and preferences.
